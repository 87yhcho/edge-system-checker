# 시스템 점검 상세 리포트 예시

## 업데이트 내용

시스템 종합 점검 결과를 더 상세하게 표시하도록 개선했습니다.

### 변경 전
```
[5/5] 시스템 종합 점검
상태: PASS
```

### 변경 후
```
[5/5] 시스템 종합 점검
전체 상태: PASS

[OS 설정]
  ✓ TIMEZONE: Time zone: Etc/UTC (UTC, +0000) [PASS]
  ✓ LOCALE: LANG=ko_KR.UTF-8 [PASS]
  ✓ ENCODING: UTF-8 [PASS]

[서비스 상태]
  ✓ tomcat: active [PASS]
  ✓ postgresql: active [PASS]
  ✓ nut-server: active [PASS]
  ✓ nut-monitor: active [PASS]
  ✓ stream: active [PASS]

[포트 리스닝]
  ✓ HTTP (80): Listening [PASS]
    → LISTEN 0 511 *:80 *:* users:(("nginx",pid=1234,fd=7))
  ✓ PostgreSQL (5432): Listening [PASS]
    → LISTEN 0 200 127.0.0.1:5432 0.0.0.0:* users:(("postgres",pid=5678,fd=9))
  ✗ RTSP (554): Not listening [FAIL]
  ✓ NUT (3493): Listening [PASS]
    → LISTEN 0 32 0.0.0.0:3493 0.0.0.0:* users:(("upsd",pid=9012,fd=4))

[Java 설정]
  ✓ VERSION: Java 17 [PASS]
  ✓ HEAP: Configured [PASS]
    → /etc/systemd/system/tomcat.service:Environment="JAVA_OPTS=-Xms2g -Xmx4g"

[네트워크]
  ✓ IP 주소: 2개 [PASS]
    → enp1s0 10.1.10.128/24
    → docker0 172.17.0.1/16
  ✓ 활성 연결: 2개 [PASS]
    → Wired connection 1
    → docker0

[디스크 공간]
  ✓ 루트 파티션 (/): 사용률 45%, 여유 104G/190G [PASS]
  ⚠ PostgreSQL: 사용률 72%, 여유 28G [WARN]

[Cron 작업]
  ✓ Crontab 작업: 3개 [PASS]
    → 1 0 * * * /usr/local/bin/sync_time.sh
    → 0 2 * * * /usr/local/bin/backup.sh
    → */5 * * * * /usr/local/bin/health_check.sh
  ✓ 일일 동기화 (00:01 UTC): Found [PASS]
    (기대값: Daily 00:01 UTC job)

[점검 통계]
  - PASS: 18개
  - FAIL: 1개
  - WARN: 1개
  - SKIP: 0개
```

## 콘솔 최종 요약 테이블

프로그램 실행 마지막에 표시되는 최종 요약 테이블에도 시스템 상세 정보가 추가됩니다:

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                              전체 요약                                        ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  항목              상태                                                        ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  UPS/NUT          ✓ PASS                                                     ║
║  카메라            ✓ PASS                                                     ║
║  PostgreSQL       ✓ PASS                                                     ║
║  NAS              ✓ PASS                                                     ║
║  시스템            ✓ PASS                                                     ║
╚══════════════════════════════════════════════════════════════════════════════╝

╔══════════════════════════════════════════════════════════════════════════════╗
║                           카메라 상세 결과                                    ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  카메라        IP                원본      블러      로그                      ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  카메라 1      192.168.1.101    PASS     PASS     PASS                       ║
║  카메라 2      192.168.1.102    PASS     PASS     PASS                       ║
║  카메라 3      192.168.1.103    PASS     PASS     PASS                       ║
║  카메라 4      192.168.1.104    PASS     PASS     PASS                       ║
╚══════════════════════════════════════════════════════════════════════════════╝

  스트림 점검: PASS 4, FAIL 0, SKIP 0
  영상 파일: ✓ 영상 파일 저장 완료

╔══════════════════════════════════════════════════════════════════════════════╗
║                          시스템 점검 상세 결과                                ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  서비스 상태          상태             판정                                   ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  tomcat              active          PASS                                    ║
║  postgresql          active          PASS                                    ║
║  nut-server          active          PASS                                    ║
║  nut-monitor         active          PASS                                    ║
║  stream              active          PASS                                    ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  포트 리스닝          상태             판정                                   ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  HTTP (80)           Listening       PASS                                    ║
║  PostgreSQL (5432)   Listening       PASS                                    ║
║  RTSP (554)          Not listening   FAIL                                    ║
║  NUT (3493)          Listening       PASS                                    ║
╠══════════════════════════════════════════════════════════════════════════════╣
║  점검 통계                                                                    ║
║    PASS: 18, FAIL: 1, WARN: 1, SKIP: 0                                      ║
╚══════════════════════════════════════════════════════════════════════════════╝
```

## 파일 리포트 예시

`report_2025-10-27_15-30-45.txt` 파일에 저장되는 내용:

```
================================================================================
Edge 시스템 점검 리포트
================================================================================
점검 일시: 2025-10-27 15:30:45
호스트명: iuu-edge-002
================================================================================

[요약]
  UPS/NUT: PASS
  카메라: PASS
  PostgreSQL: PASS
  NAS: PASS
  시스템: PASS

--------------------------------------------------------------------------------
[1/5] UPS/NUT 상태 점검
--------------------------------------------------------------------------------
  상태: PASS
  
  [NUT 서비스 상태]
    ✓ nut-driver@ups.service: active
    ✓ nut-server.service: active
    ✓ nut-monitor.service: active
  
  [포트 리스닝]
    ✓ 3493 포트: LISTENING
  
  [UPS 데이터]
    - ups.status: OL (Online)
    - battery.charge: 100%
    - input.voltage: 220V
    - ups.load: 45%
    - ups.model: CPS1500PIE

--------------------------------------------------------------------------------
[2/5] 카메라 RTSP 점검
--------------------------------------------------------------------------------
  상태: PASS
  
  총 카메라: 4대
  PASS: 4, FAIL: 0, SKIP: 0
  
  개별 카메라 상태:
    카메라            IP                원본 영상      블러 스트리밍   로그        
    ----------------------------------------------------------------------
    카메라 1         192.168.1.101    PASS          PASS          PASS        
      로그 시각: 2025-10-27 15:25:30
      프레임 수: 4500
      영상 길이: 300.0초
    카메라 2         192.168.1.102    PASS          PASS          PASS        
      로그 시각: 2025-10-27 15:25:35
      프레임 수: 4485
      영상 길이: 299.0초
    카메라 3         192.168.1.103    PASS          PASS          PASS        
      로그 시각: 2025-10-27 15:25:40
      프레임 수: 4512
      영상 길이: 300.8초
    카메라 4         192.168.1.104    PASS          PASS          PASS        
      로그 시각: 2025-10-27 15:25:45
      프레임 수: 4498
      영상 길이: 299.9초
  
  영상 파일 저장 확인:
    상태: PASS
    저장됨: 카메라 [1, 2, 3, 4]

--------------------------------------------------------------------------------
[3/5] PostgreSQL 데이터 점검
--------------------------------------------------------------------------------
  상태: PASS
  연결: 성공
  
  테이블: blackbox_log
  최근 데이터 (5건):
    [1] 2025-10-27 15:29:58 | GPS: 35.1234,129.5678 | Speed: 5.2
    [2] 2025-10-27 15:29:57 | GPS: 35.1234,129.5678 | Speed: 5.1
    [3] 2025-10-27 15:29:56 | GPS: 35.1234,129.5678 | Speed: 5.0
    [4] 2025-10-27 15:29:55 | GPS: 35.1234,129.5678 | Speed: 4.9
    [5] 2025-10-27 15:29:54 | GPS: 35.1234,129.5678 | Speed: 4.8

--------------------------------------------------------------------------------
[4/5] NAS 상태 점검
--------------------------------------------------------------------------------
  상태: PASS
  연결: 성공
  
  시스템 정보:
    - 모델: Synology DS920+
    - 운영체제: DSM 7.2
    - 가동시간: 45 days

--------------------------------------------------------------------------------
[5/5] 시스템 종합 점검
--------------------------------------------------------------------------------
  전체 상태: PASS

  [OS 설정]
    ✓ TIMEZONE: Time zone: Etc/UTC (UTC, +0000) [PASS]
    ✓ LOCALE: LANG=ko_KR.UTF-8 [PASS]
    ✓ ENCODING: UTF-8 [PASS]

  [서비스 상태]
    ✓ tomcat: active [PASS]
    ✓ postgresql: active [PASS]
    ✓ nut-server: active [PASS]
    ✓ nut-monitor: active [PASS]
    ✓ stream: active [PASS]

  [포트 리스닝]
    ✓ HTTP (80): Listening [PASS]
      → LISTEN 0 511 *:80 *:* users:(("nginx",pid=1234,fd=7))
    ✓ PostgreSQL (5432): Listening [PASS]
      → LISTEN 0 200 127.0.0.1:5432 0.0.0.0:* users:(("postgres",pid=5678
    ✗ RTSP (554): Not listening [FAIL]
    ✓ NUT (3493): Listening [PASS]
      → LISTEN 0 32 0.0.0.0:3493 0.0.0.0:* users:(("upsd",pid=9012,fd=4))

  [Java 설정]
    ✓ VERSION: Java 17 [PASS]
    ✓ HEAP: Configured [PASS]
      → /etc/systemd/system/tomcat.service:Environment="JAVA_OPTS=-Xms2g

  [네트워크]
    ✓ IP 주소: 2개 [PASS]
      → enp1s0 10.1.10.128/24
      → docker0 172.17.0.1/16
    ✓ 활성 연결: 2개 [PASS]
      → Wired connection 1
      → docker0

  [디스크 공간]
    ✓ 루트 파티션 (/): 사용률 45%, 여유 104G/190G [PASS]
    ⚠ PostgreSQL: 사용률 72%, 여유 28G [WARN]

  [Cron 작업]
    ✓ Crontab 작업: 3개 [PASS]
      → 1 0 * * * /usr/local/bin/sync_time.sh
      → 0 2 * * * /usr/local/bin/backup.sh
      → */5 * * * * /usr/local/bin/health_check.sh
    ✓ 일일 동기화 (00:01 UTC): Found [PASS]
      (기대값: Daily 00:01 UTC job)

  [점검 통계]
    - PASS: 18개
    - FAIL: 1개
    - WARN: 1개
    - SKIP: 0개

================================================================================
점검 완료
================================================================================
```

## 주요 개선 사항

### 1. 서비스 상태 상세 표시
각 서비스의 이름과 상태를 개별적으로 표시합니다:
- tomcat, postgresql, nut-server, nut-monitor, stream 등
- 각 서비스의 active/inactive/failed 상태 표시
- PASS/FAIL/SKIP 판정 표시

### 2. 포트 리스닝 상세 정보
각 포트의 리스닝 상태를 프로세스 정보와 함께 표시:
- 포트 번호와 서비스명
- 리스닝 여부
- ss 명령어로 확인한 프로세스 정보 (PID, 프로그램명 등)

### 3. 카테고리별 구분
OS 설정, 서비스, 포트, Java, 네트워크, 디스크, Cron을 명확히 구분하여 표시합니다.

### 4. 통계 정보
전체 점검 항목의 PASS/FAIL/WARN/SKIP 개수를 집계하여 표시합니다.

### 5. 시각적 표시
- ✓ (PASS), ✗ (FAIL), ⚠ (WARN) 기호로 한눈에 상태 파악
- 들여쓰기로 계층 구조 명확화
- → 화살표로 상세 정보 표시

## 테스트 방법

```bash
ssh koast-user@10.1.10.128
cd ~/edge-system-checker
source venv/bin/activate
python checker.py
```

점검 완료 후:
1. 콘솔에서 상세한 시스템 점검 테이블 확인
2. 생성된 리포트 파일에서 더 자세한 정보 확인

```bash
# 리포트 파일 확인
cat report_2025-10-27_15-30-45.txt

# 또는
less report_2025-10-27_15-30-45.txt
```

